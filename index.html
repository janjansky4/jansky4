<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pac-Man</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #000;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }
    #game {
      position: relative;
      width: 560px;
      height: 620px;
      border: 4px solid #00f;
      overflow: hidden;
      background: #000;
    }
    .wall { background: #00f; }
    .dot { background: #ff0; width: 8px; height: 8px; border-radius: 50%; margin: 8px; }
    .power { background: #fff; width: 12px; height: 12px; border-radius: 50%; margin: 6px; animation: blink 1s infinite; }
    @keyframes blink { 0%,100% {opacity:1} 50%{opacity:0.5} }
    #pacman {
      position: absolute;
      width: 28px;
      height: 28px;
      background: #ff0;
      border-radius: 50%;
      clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%, 20% 50%);
      transition: none;
      z-index: 10;
    }
    .ghost {
      position: absolute;
      width: 28px;
      height: 28px;
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      z-index: 5;
    }
    #score {
      position: absolute;
      top: 10px;
      left: 10px;
      color: #fff;
      font-size: 20px;
      z-index: 20;
    }
    #game-over {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #f00;
      font-size: 40px;
      font-weight: bold;
      display: none;
      z-index: 30;
      text-align: center;
    }
  </style>
</head>
<body>

<div id="game">
  <div id="score">Skóre: 0</div>
  <div id="game-over">KONEC HRY<br><small>Stiskni mezerník pro restart</small></div>
</div>

<script>
  // === KONFIGURACE HRY ===
  const GRID_SIZE = 28;
  const CELL_SIZE = 20;
  const game = document.getElementById('game');
  const scoreDisplay = document.getElementById('score');
  const gameOverScreen = document.getElementById('game-over');

  // Layout bludiště (1 = zeď, 0 = tečka, 2 = super tečka, 3 = prázdné)
  const layout = [
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1],
    [1,2,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,2,1],
    [1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,0,1],
    [1,0,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,0,1],
    [1,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,1],
    [1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1],
    [1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1],
    [1,1,1,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,1],
    [1,1,1,1,1,1,0,1,1,0,1,1,1,3,3,1,1,1,0,1,1,0,1,1,1,1,1,1],
    [1,1,1,1,1,1,0,1,1,0,1,3,3,3,3,3,3,1,0,1,1,0,1,1,1,1,1,1],
    [3,3,3,3,3,3,0,0,0,0,1,3,3,3,3,3,3,1,0,0,0,0,3,3,3,3,3,3],
    [1,1,1,1,1,1,0,1,1,0,1,3,3,3,3,3,3,1,0,1,1,0,1,1,1,1,1,1],
    [1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1],
    [1,1,1,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,1],
    [1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1],
    [1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1],
    [1,2,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,2,1],
    [1,1,1,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,0,1,1,1],
    [1,1,1,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,0,1,1,1],
    [1,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,1],
    [1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
  ];

  let grid = [];
  let pacman = { x: 14, y: 23, dir: 'left', mouth: true };
  let ghosts = [
    { x: 13, y: 11, color: '#f00', dir: 'up', scared: false },
    { x: 14, y: 11, color: '#ffb8ff', dir: 'up', scared: false },
    { x: 15, y: 11, color: '#00ffff', dir: 'up', scared: false },
    { x: 13, y: 14, color: '#ffb851', dir: 'down', scared: false }
  ];
  let score = 0;
  let powerMode = false;
  let powerTimer = 0;
  let gameActive = true;

  // === VYKRESLENÍ HRY ===
  function createGrid() {
    game.innerHTML = '<div id="score">Skóre: 0</div><div id="game-over">KONEC HRY<br><small>Stiskni mezerník pro restart</small></div>';
    grid = [];
    for (let y = 0; y < GRID_SIZE; y++) {
      for (let x = 0; x < GRID_SIZE; x++) {
        const cell = document.createElement('div');
        cell.style.position = 'absolute';
        cell.style.width = cell.style.height = CELL_SIZE + 'px';
        cell.style.left = x * CELL_SIZE + 'px';
        cell.style.top = y * CELL_SIZE + 'px';
        cell.dataset.x = x;
        cell.dataset.y = y;

        if (layout[y][x] === 1) {
          cell.className = 'wall';
        } else if (layout[y][x] === 0) {
          cell.className = 'dot';
        } else if (layout[y][x] === 2) {
          cell.className = 'power';
        } else {
          cell.style.background = '#000';
        }
        game.appendChild(cell);
        grid.push(cell);
      }
    }

    // Pac-Man
    const pac = document.createElement('div');
    pac.id = 'pacman';
    game.appendChild(pac);

    // Duchové
    ghosts.forEach(g => {
      const ghost = document.createElement('div');
      ghost.className = 'ghost';
      ghost.style.background = g.color;
      ghost.dataset.id = ghosts.indexOf(g);
      game.appendChild(ghost);
    });

    updatePositions();
  }

  function updatePositions() {
    const pac = document.getElementById('pacman');
    pac.style.left = pacman.x * CELL_SIZE + 'px';
    pac.style.top = pacman.y * CELL_SIZE + 'px';
    pac.style.transform = `rotate(${pacman.dir === 'right' ? 0 : pacman.dir === 'down' ? 90 : pacman.dir === 'left' ? 180 : 270}deg)`;
    pac.style.clipPath = pacman.mouth
      ? 'polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%, 20% 50%)'
      : 'polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 50%)';

    ghosts.forEach((g, i) => Create a simple Pac-Man game in HTML/CSS/JS.
      const ghost = document.querySelectorAll('.ghost')[i];
      ghost.style.left = g.x * CELL_SIZE + 'px';
      ghost.style.top = g.y * CELL_SIZE + 'px';
      ghost.style.background = powerMode && g.scared ? '#00f' : g.color;
    });
  }

  // === POHYB PAC-MANA ===
  const keys = {};
  document.addEventListener('keydown', e => keys[e.key] = true);
  document.addEventListener('keyup', e => keys[e.key] = false);

  function movePacman() {
    if (!gameActive) return;
    let nx = pacman.x, ny = pacman.y;
    if (keys['ArrowRight'] || keys['d']) { nx++; pacman.dir = 'right'; }
    if (keys['ArrowLeft'] || keys['a']) { nx--; pacman.dir = 'left'; }
    if (keys['ArrowDown'] || keys['s']) { ny++; pacman.dir = 'down'; }
    if (keys['ArrowUp'] || keys['w']) { ny--; pacman.dir = 'up'; }

    if (nx < 0) nx = GRID_SIZE - 1;
    if (nx >= GRID_SIZE) nx = 0;

    if (layout[ny][nx] !== 1) {
      pacman.x = nx;
      pacman.y = ny;

      const cell = layout[ny][nx];
      if (cell === 0) {
        layout[ny][nx] = 3;
        score += 10;
      } else if (cell === 2) {
        layout[ny][nx] = 3;
        score += 50;
        powerMode = true;
        powerTimer = 150;
        ghosts.forEach(g => g.scared = true);
      }
      scoreDisplay.textContent = `Skóre: ${score}`;
    }

    // Animace pusinky
    pacman.mouth = !pacman.mouth;
    updatePositions();
    checkWin();
  }

  // === POHYB DUCHŮ ===
  function moveGhosts() {
    if (!gameActive) return;
    ghosts.forEach(g => {
      if (powerTimer > 0 && g.scared) {
        // Náhodný pohyb v power módu
        const dirs = [['up',0,-1],['down',0,1],['left',-1,0],['right',1,0]];
        const valid = dirs.filter(d => {
          const nx = g.x + d[1], ny = g.y + d[2];
          return nx >= 0 && nx < GRID_SIZE && ny >= 0 && ny < GRID_SIZE && layout[ny][nx] !== 1;
        });
        if (valid.length > 0) {
          const rand = valid[Math.floor(Math.random() * valid.length)];
          g.x += rand[1]; g.y += rand[2]; g.dir = rand[0];
        }
      } else {
        // Normální chování – honí Pac-Mana
        const dx = pacman.x - g.x;
        const dy = pacman.y - g.y;
        const dirs = [];
        if (Math.abs(dx) > Math.abs(dy)) {
          dirs.push(dx > 0 ? 'right' : 'left');
          dirs.push(dy > 0 ? 'down' : 'up');
        } else {
          dirs.push(dy > 0 ? 'down' : 'up');
          dirs.push(dx > 0 ? 'right' : 'left');
        }
        for (const dir of dirs) {
          let nx = g.x, ny = g.y;
          if (dir === 'right') nx++;
          if (dir === 'left') nx--;
          if (dir === 'down') ny++;
          if (dir === 'up') ny--;
          if (nx >= 0 && nx < GRID_SIZE && ny >= 0 && ny < GRID_SIZE && layout[ny][nx] !== 1) {
            g.x = nx; g.y = ny; g.dir = dir; break;
          }
        }
      }

      // Kolize s Pac-Manem
      if (g.x === pacman.x && g.y === pacman.y) {
        if (powerMode && g.scared) {
          score += 200;
          g.x = 14; g.y = 14; // zpět do domečku
        } else {
          gameOver();
        }
      }
    });
    updatePositions();
  }

  function gameOver() {
    gameActive = false;
    gameOverScreen.style.display = 'block';
  }

  function checkWin() {
    if (layout.flat().filter(c => c === 0 || c === 2).length === 0) {
      gameActive = false;
      gameOverScreen.textContent = 'VYHRÁL JSI!\nSkóre: ' + score;
      gameOverScreen.style.display = 'block';
    }
  }

  // === HLAVNÍ SMYČKA ===
  function gameLoop() {
    movePacman();
    if (Math.random() < 0.3) moveGhosts(); // duchové se pohybují pomaleji
    if (powerTimer > 0) {
      powerTimer--;
      if (powerTimer === 0) {
        powerMode = false;
        ghosts.forEach(g => g.scared = false);
      }
    }
    requestAnimationFrame(gameLoop);
  }

  // === RESTART ===
  document.addEventListener('keydown', e => {
    if (e.key === ' ' && !gameActive) {
      location.reload();
    }
  });

  // Spuštění
  createGrid();
  setInterval(() => {
    const dots = document.querySelectorAll('.dot, .power');
    dots.forEach(d => {
      if (layout[parseInt(d.dataset.y)][parseInt(d.dataset.x)] === 3) {
        d.style.background = '#000';
      }
    });
  }, 100);
  requestAnimationFrame(gameLoop);
</script>

</body>
</html>
