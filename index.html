<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pac-Man</title>
  <style>
    body {
      background: black;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    canvas {
      background: #000;
      border: 2px solid #222;
    }
  </style>
</head>
<body>
  <canvas id="game" width="448" height="496"></canvas>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const tileSize = 16;
    const map = [
      "############################",
      "#............##............#",
      "#.####.#####.##.#####.####.#",
      "#o####.#####.##.#####.####o#",
      "#.####.#####.##.#####.####.#",
      "#..........................#",
      "#.####.##.########.##.####.#",
      "#.####.##.########.##.####.#",
      "#......##....##....##......#",
      "######.##### ## #####.######",
      "     #.##### ## #####.#     ",
      "     #.##          ##.#     ",
      "     #.## ###--### ##.#     ",
      "######.## #      # ##.######",
      "      .   #      #   .      ",
      "######.## #      # ##.######",
      "     #.## ######## ##.#     ",
      "     #.##          ##.#     ",
      "     #.## ######## ##.#     ",
      "######.## ######## ##.######",
      "#............##............#",
      "#.####.#####.##.#####.####.#",
      "#o..##................##..o#",
      "###.##.##.########.##.##.###",
      "#......##....##....##......#",
      "#.##########.##.##########.#",
      "#..........................#",
      "############################"
    ];

    const pacman = {
      x: 14 * tileSize,
      y: 23 * tileSize,
      dx: 0,
      dy: 0,
      speed: 2,
      mouth: 0,
      mouthDir: 1
    };

    document.addEventListener("keydown", e => {
      if (e.key === "ArrowUp") { pacman.dx = 0; pacman.dy = -pacman.speed; }
      if (e.key === "ArrowDown") { pacman.dx = 0; pacman.dy = pacman.speed; }
      if (e.key === "ArrowLeft") { pacman.dx = -pacman.speed; pacman.dy = 0; }
      if (e.key === "ArrowRight") { pacman.dx = pacman.speed; pacman.dy = 0; }
    });

    function drawMap() {
      for (let y = 0; y < map.length; y++) {
        for (let x = 0; x < map[y].length; x++) {
          const tile = map[y][x];
          if (tile === "#") {
            ctx.fillStyle = "#1919A6";
            ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
          } else if (tile === ".") {
            ctx.fillStyle = "yellow";
            ctx.beginPath();
            ctx.arc(x * tileSize + 8, y * tileSize + 8, 2, 0, Math.PI * 2);
            ctx.fill();
          } else if (tile === "o") {
            ctx.fillStyle = "yellow";
            ctx.beginPath();
            ctx.arc(x * tileSize + 8, y * tileSize + 8, 4, 0, Math.PI * 2);
            ctx.fill();
          }
        }
      }
    }

    function drawPacman() {
      pacman.mouth += pacman.mouthDir * 0.2;
      if (pacman.mouth > 1 || pacman.mouth < 0) pacman.mouthDir *= -1;

      let angle = Math.atan2(pacman.dy, pacman.dx);
      if (isNaN(angle)) angle = 0;

      ctx.fillStyle = "yellow";
      ctx.beginPath();
      ctx.moveTo(pacman.x + 8, pacman.y + 8);
      ctx.arc(
        pacman.x + 8,
        pacman.y + 8,
        8,
        angle + pacman.mouth * 0.5,
        angle + Math.PI * 2 - pacman.mouth * 0.5
      );
      ctx.closePath();
      ctx.fill();
    }

    function update() {
      const newX = pacman.x + pacman.dx;
      const newY = pacman.y + pacman.dy;

      const gridX = Math.floor(newX / tileSize);
      const gridY = Math.floor(newY / tileSize);

      if (map[gridY] && map[gridY][gridX] !== "#") {
        pacman.x = newX;
        pacman.y = newY;

        // Snědení bodu
        const char = map[gridY][gridX];
        if (char === "." || char === "o") {
          map[gridY] = map[gridY].substring(0, gridX) + " " + map[gridY].substring(gridX + 1);
        }
      }
    }

    function loop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawMap();
      drawPacman();
      update();
      requestAnimationFrame(loop);
    }

    loop();
  </script>
</body>
</html>
